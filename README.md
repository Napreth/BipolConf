# BipolConf

BipolConf æ˜¯ä¸€ä¸ªä»¥å‘½åç©ºé—´ä¸ºåŸºç¡€ï¼Œé€šè¿‡åŒå‘ç­–ç•¥æ§åˆ¶å®ç°å¯éªŒè¯ç»§æ‰¿çš„é…ç½®ç³»ç»Ÿã€‚
å®ƒå°†é…ç½®çš„ä¼ æ’­ä¸è®¿é—®è¡Œä¸ºè§†ä¸ºâ€œç­–ç•¥å†³ç­–â€ï¼Œè€Œéå•çº¯çš„é”®å€¼æŸ¥æ‰¾ï¼Œå¼ºè°ƒå¯éªŒè¯æ€§ä¸æ¨¡å—è‡ªæ²»ã€‚

## ğŸ§  è®¾è®¡ç†å¿µæ¦‚è¿°

**æ ¸å¿ƒå®šä¹‰ï¼š**
BipolConf æ˜¯ä¸€ä¸ªä»¥å‘½åç©ºé—´ä¸ºåŸºç¡€ã€é€šè¿‡åŒå‘ç­–ç•¥æ§åˆ¶å®ç°å¯éªŒè¯ç»§æ‰¿çš„é…ç½®ç³»ç»Ÿã€‚
å®ƒå°†é…ç½®çš„ä¼ æ’­ä¸è®¿é—®è¡Œä¸ºè§†ä¸ºâ€œç­–ç•¥å†³ç­–â€ï¼Œè€Œéâ€œé”®å€¼æŸ¥æ‰¾â€ã€‚

### 1. å‘½åç©ºé—´åˆ†å±‚ï¼ˆHierarchical Namespaceï¼‰

é…ç½®è¢«ç»„ç»‡ä¸ºæ ‘çŠ¶ç»“æ„ï¼ˆå¦‚ `page.home.router`ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ç‹¬ç«‹çš„é…ç½®åŸŸï¼ˆscopeï¼‰ï¼Œå¹¶æŒ‰å±‚çº§å½¢æˆä½œç”¨åŸŸé“¾ã€‚
æŸ¥æ‰¾éµå¾ªâ€œä»å…·ä½“åˆ°æ³›åŒ–â€çš„çŸ­è·¯ç­–ç•¥ï¼š`page.home.router â†’ page.home â†’ page â†’ *`

### 2. åŒå‘ç­–ç•¥ç»§æ‰¿ï¼ˆBidirectional Policy Inheritanceï¼‰

ç»§æ‰¿ä¸å†æ˜¯å•å‘çš„â€œçˆ¶ä¼ å­â€ï¼Œè€Œæ˜¯ç”±ä¸¤ä¸ªæ–¹å‘åŒæ—¶å†³å®šï¼š

- å‘ä¸Šç­–ç•¥ï¼ˆ`__up_policies__`ï¼‰ï¼šå­èŠ‚ç‚¹å£°æ˜è‡ªå·±â€œæ„¿æ„ç»§æ‰¿å“ªäº›é”®â€ï¼›
- å‘ä¸‹ç­–ç•¥ï¼ˆ`__down_policies__`ï¼‰ï¼šçˆ¶èŠ‚ç‚¹å£°æ˜è‡ªå·±â€œå…è®¸å“ªäº›é”®è¢«ç»§æ‰¿â€ã€‚

æœ€ç»ˆç”Ÿæ•ˆçš„ç»§æ‰¿ç”±é€»è¾‘è¡¨è¾¾å¼å†³å®šï¼š
`effective = allow_down(parent, key, child) AND allow_up(child, key)`

### 3. é®è”½å¼ç»§æ‰¿ï¼ˆShadowing Inheritanceï¼‰

åŒåé”®åœ¨å­èŠ‚ç‚¹å‡ºç°æ—¶ï¼Œå®Œå…¨è¦†ç›–çˆ¶èŠ‚ç‚¹çš„å®šä¹‰ï¼›ä¸ä¼šè¿›è¡Œåˆå¹¶ã€å åŠ æˆ–ç±»å‹èåˆã€‚
æ¯ä¸ªèŠ‚ç‚¹åªçœ‹åˆ°å½“å‰ç­–ç•¥å…è®¸å¯è§çš„éƒ¨åˆ†çˆ¶é…ç½®ï¼Œå…¶ä½™å¯¹å®ƒæ˜¯â€œé»‘ç›’â€ã€‚

### 4. çŸ­è·¯æŸ¥æ‰¾ï¼ˆShort-circuit Lookupï¼‰

é…ç½®æŸ¥è¯¢ä¸ºç¡®å®šæ€§é“¾å¼æœç´¢ï¼šä¸€æ—¦åœ¨æŸå±‚æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œç«‹å³è¿”å›ï¼›è‹¥ç­–ç•¥æ‹’ç»ç»§æ‰¿ï¼Œåˆ™é“¾è·¯ä¸­æ–­ã€‚
æ­¤æ¨¡å‹å¯æ˜ å°„ä¸ºæœ‰é™çŠ¶æ€æœºï¼Œè¡Œä¸ºå¯é¢„æµ‹ä¸”å¯éªŒè¯ã€‚

### 5. ç­–ç•¥ä¼˜å…ˆçº§ä½“ç³»ï¼ˆPolicy Precedenceï¼‰

ç»§æ‰¿æ§åˆ¶è§„åˆ™å…·æœ‰åˆ†å±‚ä¼˜å…ˆçº§ï¼š

ä¾‹å¤–ç­–ç•¥ (A) > å­èŠ‚ç‚¹æˆ–é”®çº§ç­–ç•¥ (B1/B2) = å…¨å±€ç­–ç•¥ (C)
(B å’Œ C äº’æ–¥)

ç¡®ä¿åœ¨å¤æ‚é…ç½®ä¸­ä»èƒ½å¾—åˆ°å”¯ä¸€ã€å¯è¯æ˜çš„å†³ç­–ç»“æœã€‚

### 6. èŠ‚ç‚¹è‡ªæ²»ï¼ˆConfiguration Autonomyï¼‰

æ¯ä¸ªé…ç½®èŠ‚ç‚¹éƒ½æ˜¯è‡ªæ²»å•å…ƒï¼š

- å†³å®šè‡ªå·±èƒ½ç»§æ‰¿ä»€ä¹ˆï¼›
- å†³å®šè‡ªå·±èƒ½è¢«è°ç»§æ‰¿ã€‚

è¿™ç§è®¾è®¡è®©æ¨¡å—é—´é…ç½®å…·å¤‡æ¸…æ™°è¾¹ç•Œï¼Œé¿å…å…¨å±€æ±¡æŸ“ã€‚

### ğŸ“œ æ€»è¿°ä¸€å¥è¯

> BipolConf å°†é…ç½®ç»§æ‰¿è½¬åŒ–ä¸ºå¯éªŒè¯çš„ç­–ç•¥å†³ç­–è¿‡ç¨‹ï¼Œä»¥å‘½åç©ºé—´åˆ’å®šä½œç”¨åŸŸï¼Œä»¥åŒå‘ç­–ç•¥ç¡®å®šå¯è§åŸŸï¼Œä»è€Œåœ¨çµæ´»æ€§ä¸æ§åˆ¶æ€§ä¹‹é—´å–å¾—ä¸¥æ ¼å¹³è¡¡ã€‚

## ç­–ç•¥è¯´æ˜

ä¸‹é¢çš„è¯´æ˜æ”¾åœ¨â€œè®¾è®¡ç†å¿µâ€ä¸â€œå¿«é€Ÿå¼€å§‹â€ä¹‹é—´ï¼Œæ—¨åœ¨å‘ä½¿ç”¨è€…è¯´æ˜å¦‚ä½•ä¹¦å†™ `__up_policies__` ä¸ `__down_policies__`ï¼Œä»¥åŠæ¯ä¸ªç­–ç•¥ç±»å‹çš„è¯­ä¹‰ä¸ç¤ºä¾‹ã€‚

### å‘ä¸Šç»§æ‰¿ç­–ç•¥ï¼ˆ__up_policies__ï¼‰â€”â€”å­èŠ‚ç‚¹å£°æ˜â€œæ„¿æ„ç»§æ‰¿ä»€ä¹ˆâ€

ç»“æ„ç¤ºä¾‹ï¼ˆJSONï¼‰ï¼š

```json
"__up_policies__": [
	["ç­–ç•¥ç±»å‹"],
	{"è¯¦ç»†é…ç½®": {}}
]
```

ç­–ç•¥ç±»å‹è¯´æ˜ï¼š

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| *inherit | ï¼ˆé»˜è®¤ï¼‰å…è®¸ä»çˆ¶èŠ‚ç‚¹ç»§æ‰¿æ‰€æœ‰é…ç½® |
| no-inherit | ä¸ä»çˆ¶èŠ‚ç‚¹ç»§æ‰¿ä»»ä½•é…ç½®ï¼ˆæ–­å¼€ç»§æ‰¿é“¾ï¼‰ |
| partial-inherit | ä»…ç»§æ‰¿ç™½åå•ä¸­çš„é…ç½®é¡¹ |
| partial-no-inherit | ç¦æ­¢ç»§æ‰¿é»‘åå•ä¸­çš„é…ç½®é¡¹ |

ç¤ºä¾‹ï¼š

```json
"page.home": {
	"__up_policies__": [
		"pattern": ["partial-inherit"],
		"keys": {
			"partial-inherit": ["theme", "language"]
		}
	],
	"timeout": 2000
}
```

è¯´æ˜ï¼šä»¥ä¸Šç¤ºä¾‹è¡¨ç¤º `page.home` ä»…æ„¿æ„ç»§æ‰¿ `theme` ä¸ `language` ä¸¤ä¸ªé”®ï¼ˆå…¶ä½™é”®å³ä½¿çˆ¶èŠ‚ç‚¹æœ‰ä¹Ÿä¸å¯è§ï¼‰ã€‚

### å‘ä¸‹ç»§æ‰¿ç­–ç•¥ï¼ˆ__down_policies__ï¼‰â€”â€”çˆ¶èŠ‚ç‚¹å£°æ˜â€œå…è®¸å­èŠ‚ç‚¹ç»§æ‰¿ä»€ä¹ˆâ€

`__down_policies__` æ§åˆ¶å½“å‰èŠ‚ç‚¹çš„é…ç½®å¦‚ä½•è¢«å­èŠ‚ç‚¹ç»§æ‰¿ï¼š

ç­–ç•¥ç±»å‹è¯´æ˜ï¼š

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| *inheritable | ï¼ˆé»˜è®¤ï¼‰å…è®¸æ‰€æœ‰å­èŠ‚ç‚¹ç»§æ‰¿æ‰€æœ‰é…ç½® |
| uninheritable | ä¸å…è®¸ä»»ä½•å­èŠ‚ç‚¹ç»§æ‰¿ä»»ä½•é…ç½® |
| partial-inheritable | ä»…ç™½åå•ä¸­çš„é…ç½®é¡¹å¯è¢«ç»§æ‰¿ |
| partial-uninheritable | é»‘åå•ä¸­çš„é…ç½®é¡¹ä¸å¯è¢«ç»§æ‰¿ |
| partial-subnode-inheritable | ä»…ç™½åå•ä¸­çš„å­èŠ‚ç‚¹å¯ç»§æ‰¿ |
| partial-subnode-uninheritable | é»‘åå•ä¸­çš„å­èŠ‚ç‚¹ä¸å¯ç»§æ‰¿ |
| partial-inheritable-for-partial-subnode | ç‰¹å®šé…ç½®é¡¹ä»…å¯¹ç‰¹å®šå­èŠ‚ç‚¹å¯ç»§æ‰¿ |
| partial-uninheritable-for-partial-subnode | ç‰¹å®šé…ç½®é¡¹å¯¹ç‰¹å®šå­èŠ‚ç‚¹ä¸å¯ç»§æ‰¿ |

ç»“æ„ä¸ç¤ºä¾‹ï¼š

```json
"page": {
	"__down_policies__": [
		"pattern": ["partial-inheritable", "partial-subnode-inheritable"],
		"keys": {
			"partial-inheritable": ["theme", "language"],
			"partial-subnode-inheritable": ["page.home", "page.blog"],
			"partial-inheritable-for-partial-subnode": {
				"theme": ["page.home"],
				"debug": ["page.admin"]
			}
		}
	],
	"theme": "dark",
	"debug": false,
	"api_key": "secret"
}
```

è¯´æ˜è¦ç‚¹ï¼š

- `__up_policies__` ä¸ `__down_policies__` æ˜¯äº’ç›¸é…åˆçš„ï¼šæœ€ç»ˆèƒ½å¦ç»§æ‰¿ç”± `allow_down(parent,key,child) AND allow_up(child,key)` å†³å®šï¼›
- å½“çˆ¶èŠ‚ç‚¹ä½¿ç”¨å…¨å±€ç­–ç•¥ï¼ˆä¾‹å¦‚ `uninheritable`ï¼‰æ—¶ï¼Œä¸å…è®¸ä»»ä½•å‘ä¸Šç»§æ‰¿ï¼›è‹¥çˆ¶èŠ‚ç‚¹ä½¿ç”¨éƒ¨åˆ†ç­–ç•¥ï¼ˆ`partial-*`ï¼‰ï¼Œåˆ™éœ€ç»“åˆ keys/å­èŠ‚ç‚¹ç™½åå•æˆ–é»‘åå•åˆ¤æ–­ï¼›
- æŸäº›ç­–ç•¥ç”¨äºåˆ†åˆ«é™å®šâ€œå“ªäº›é”®å¯ç»§æ‰¿â€ä¸â€œå“ªäº›å­èŠ‚ç‚¹å¯ç»§æ‰¿â€ï¼Œè¿˜å¯ä»¥é€šè¿‡ `partial-inheritable-for-partial-subnode` / `partial-uninheritable-for-partial-subnode` åšç»†ç²’åº¦ä¾‹å¤–æ§åˆ¶ã€‚

è¯·å‚è€ƒä¸Šé¢çš„ JSON ç¤ºä¾‹æ¥ä¹¦å†™ç­–ç•¥ï¼›åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œå»ºè®®å…ˆç”¨å°èŒƒå›´çš„æµ‹è¯•é…ç½®éªŒè¯ç­–ç•¥æ•ˆæœã€‚

## å¿«é€Ÿå¼€å§‹

1. åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»ºæˆ–ç¼–è¾‘ `config.json`ï¼ˆç¤ºä¾‹è§é¡¹ç›®æ–‡æ¡£æˆ– README çš„ç¤ºä¾‹èŠ‚ï¼‰ã€‚
2. åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```powershell
python -c "from src.config import Config; cfg=Config('page.home.router'); print(cfg.timeout)"
```

ç¡®ä¿ä½ çš„å½“å‰å·¥ä½œç›®å½•ä¸ºä»“åº“æ ¹ç›®å½•ï¼Œä½¿ `config.json` å¯è¢«æ¨¡å—ä»¥ç›¸å¯¹è·¯å¾„åŠ è½½ã€‚

## æ‰©å±•æ–¹å‘

- æ”¯æŒå¯é…ç½®çš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸å»¶è¿ŸåŠ è½½ï¼›
- æŠŠæ–­è¨€æ›¿æ¢æˆæ˜ç¡®å¯æ§çš„å¼‚å¸¸åˆ†æ”¯ï¼Œå¢å¼ºé”™è¯¯ä¿¡æ¯ï¼›
- æä¾›æ›´å‹å¥½çš„å…¬å¼€ APIï¼ˆ`get`/`set`/`save`/`reload`ï¼‰ä¸å•å…ƒæµ‹è¯•è¦†ç›–å…³é”®ç­–ç•¥ç»„åˆï¼›
- æ”¹è¿›ç­–ç•¥å£°æ˜çš„ JSON Schemaï¼Œå¹¶æ·»åŠ éªŒè¯é€»è¾‘ä»¥ä¾¿æ—©æœŸæŠ¥è­¦ç­–ç•¥å†²çªã€‚

